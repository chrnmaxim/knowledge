---
title: –ë–∞–∫–µ—Ç –∫–∞–∫ Volume –≤ Do—Åker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
draft: false
tags:
  - Docker
  - YandexCloud
---
#### –ë–∞–∫–µ—Ç –∫–∞–∫ Volume
–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–∫–µ—Ç Yandex Cloud ObjectStorage –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ Volume Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. 
–ë–∞–∫–µ—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤ Docker compose:

```docker-compose
volumes:
  - ./logs:/app/logs
  - ./media/dev:/app/media
```

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –±–∞–∫–µ—Ç–∞ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 
[[–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –Ω–∞ –í–ú Compute Cloud#^f3a272 |–¥–µ–º–æ–Ω–∞, –º–æ–Ω—Ç–∏—Ä—É—é—â–µ–≥–æ –±–∞–∫–µ—Ç]] –∑–∞–¥–∞—Ç—å —Ä–µ–∂–∏–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ `writes` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–º–µ—é—â–∏–º—Å—è –≤ –±–∞–∫–µ—Ç–µ —Ñ–∞–π–ª–∞–º:
```bash
--vfs-cache-mode writes
```
 * In this mode all reads and writes are buffered to and from disk. When data is read from the remote this is buffered to disk as well.
 –ê —Ç–∞–∫–∂–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
```bash
--allow-root
```
* –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±—Ö–æ–¥–∞ [[–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –Ω–∞ –í–ú Compute Cloud#^384334|–æ—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞]] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –±–∞–∫–µ—Ç–æ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ volume.
#### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

–ó–∞–ø—É—â–µ–Ω–Ω—ã–π Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –±–∞–∫–µ—Ç–∞, –µ—Å–ª–∏ –±–∞–∫–µ—Ç –±—ã–ª —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. 

–î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞:
1. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞.
2. –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

–¢.–∫. –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–µ–º–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–µ–º–æ–Ω–∞ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —à–∞–≥–∏ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ `docker-service` –∏ –µ–≥–æ –∑–∞–ø—É—Å–∫–∞ —É–∂–µ –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

–í —Å–µ–∫—Ü–∏—é `[Service]` –¥–µ–º–æ–Ω–∞ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ `docker-service` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º `rclone` –∏ –µ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

```bash
[Service]
ExecStartPre=-/usr/bin/sudo /bin/systemctl stop docker
ExecStartPost=/usr/bin/sudo /bin/systemctl start docker
```

- `ExecStartPre` –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç `docker` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º `rclone`.
- `ExecStartPost` –∑–∞–ø—É—Å—Ç–∏—Ç `docker` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ `rclone`.

–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–µ–º–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
systemctl --user daemon-reload
```

–†–∞–∑—Ä–µ—à–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–ø—Ä–∞–≤–ª—è—Ç—å `docker` —á–µ—Ä–µ–∑ `sudo` –±–µ–∑ –ø–∞—Ä–æ–ª—è:

* –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª sudoers:    
```bash
sudo visudo
```
- –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
```bash
<user_name> ALL=(ALL) NOPASSWD: /bin/systemctl stop docker, /bin/systemctl start docker
```
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `rclone<%i>.service`:
```bash
systemctl --user restart rclone@<%i>.service
```
----
üìÇ [[Yandex Cloud]]

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: 21.09.2024 20:08